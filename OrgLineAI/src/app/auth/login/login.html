<!-- login.html -->
<div class="login-container" role="main" aria-labelledby="authTitle">
  <!-- LEFT brand/marketing column -->
  <section class="brand-section" aria-label="Brand introduction">
    <div class="logo">
      <div class="logo-main" id="authTitle" aria-label="OrgLineAI">
        <img class="logo-img" src="/logo-white.png" alt="OrgLineAI" decoding="async"/>
      </div>
      <div class="logo-tagline">Intelligent Workforce Management</div>
    </div>

    <p class="brand-text">
      Streamline your leave management and attendance tracking with our professional solution
    </p>

    <div class="features" role="list">
      <div class="feature" role="listitem">
        <div class="feature-icon" aria-hidden="true"><mat-icon>schedule</mat-icon></div>
        <div class="feature-text">Real-time Attendance</div>
      </div>
      <div class="feature" role="listitem">
        <div class="feature-icon" aria-hidden="true"><mat-icon>event_available</mat-icon></div>
        <div class="feature-text">Easy Leave Management</div>
      </div>
      <div class="feature" role="listitem">
        <div class="feature-icon" aria-hidden="true"><mat-icon>show_chart</mat-icon></div>
        <div class="feature-text">Detailed Reports</div>
      </div>
    </div>
  </section>

  <!-- RIGHT auth column -->
  <section class="auth-right" aria-label="Sign in">
    <header class="login-header">
      <h1 class="login-title">Welcome Back</h1>
      <p class="login-subtitle">Sign in to access your account</p>
    </header>

    <div class="login-tabs" aria-label="Authentication method tabs">
      <mat-tab-group
        class="pill-tabs"
        [selectedIndex]="selectedTab()"
        (selectedIndexChange)="onTabChange($event)"
        animationDuration="0ms">
        <mat-tab label="Email/Password" aria-label="Email and password"></mat-tab>
        <mat-tab label="OTP Login" aria-label="One-time password login"></mat-tab>
      </mat-tab-group>
    </div>

    <div class="auth-right__content" aria-live="polite">
      <!-- Email/Password -->
      <form class="login-form form-swap" *ngIf="selectedTab() === 0" [formGroup]="passwordForm" (ngSubmit)="submitPassword()" novalidate>
        <div class="form-group">
          <label for="email">Email Address</label>
          <div class="input-with-icon">
            <mat-icon class="input-icon" aria-hidden="true">mail</mat-icon>
            <input id="email" type="email" inputmode="email" autocomplete="email"
              formControlName="email" placeholder="Enter your email" aria-required="true"
              [attr.aria-invalid]="passwordForm.controls.email.invalid && passwordForm.controls.email.touched" />
          </div>
          <p class="error" *ngIf="passwordForm.controls.email.touched && passwordForm.controls.email.hasError('required')">Email is required</p>
          <p class="error" *ngIf="passwordForm.controls.email.touched && passwordForm.controls.email.hasError('email')">Enter a valid email address</p>
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <div class="input-with-icon">
            <mat-icon class="input-icon" aria-hidden="true">lock</mat-icon>
            <input id="password" type="password" autocomplete="current-password"
              formControlName="password" placeholder="Enter your password" aria-required="true"
              [attr.aria-invalid]="passwordForm.controls.password.invalid && passwordForm.controls.password.touched" />
          </div>
          <p class="error" *ngIf="passwordForm.controls.password.touched && passwordForm.controls.password.hasError('required')">Password is required</p>
        </div>

        <div class="options">
          <mat-checkbox formControlName="remember" class="remember">Remember me</mat-checkbox>
          <a class="forgot-password" href="#" aria-label="Forgot password">Forgot Password?</a>
        </div>

        <button mat-raised-button class="btn-login" type="submit" [disabled]="passwordForm.invalid || submitting()" [attr.aria-busy]="submitting()">
          {{ submitting() ? 'Signing in…' : 'Sign In' }}
        </button>

        <div class="divider" role="separator" aria-label="Or continue with"><span>Or continue with</span></div>

        <!-- Social buttons (match Registration layout) -->
        <div class="social" role="group" aria-label="Social sign in options">
          <button type="button" class="social-btn" (click)="socialAuth('google')" mat-button>
            <mat-icon svgIcon="auth-google" aria-hidden="true"></mat-icon>
            <span>Sign in with Google</span>
          </button>
          <button type="button" class="social-btn" (click)="socialAuth('microsoft')" mat-button>
            <mat-icon svgIcon="auth-microsoft" aria-hidden="true"></mat-icon>
            <span>Sign in with Microsoft</span>
          </button>
        </div>

        <!-- Foot link (match Registration style) -->
        <p class="foot-link">
          Don't have an account?
          <a routerLink="/register" aria-label="Sign up">Sign up</a>
        </p>
      </form>

      <!-- OTP -->
      <form class="login-form form-swap" *ngIf="selectedTab() === 1" (ngSubmit)="submitOtp()" novalidate>
        <div class="form-group">
          <label for="phone">Phone Number</label>
          <div class="input-with-icon">
            <mat-icon class="input-icon" aria-hidden="true">smartphone</mat-icon>
            <input id="phone" type="tel" inputmode="tel" autocomplete="tel"
              [formControl]="phoneCtrl" placeholder="Enter your phone number" aria-required="true" />
          </div>
        </div>

        <button type="button" mat-raised-button class="btn-login"
          (click)="sendOtp()" [disabled]="sendingOtp()" [attr.aria-busy]="sendingOtp()" [ngClass]="{ 'sent': otpSent() }">
          {{ sendingOtp() ? 'Sending…' : (otpSent() ? 'OTP Sent!' : 'Send OTP') }}
        </button>

        <div class="form-group">
          <label>Enter OTP</label>
          <div class="otp-container" aria-live="polite">
            <input *ngFor="let ctrl of otpDigits; let i = index; trackBy: trackByIndex"
              #otpBox class="otp-input" type="text" inputmode="numeric" autocomplete="one-time-code"
              pattern="[0-9]*" maxlength="1" [formControl]="ctrl"
              (input)="onOtpInput(i, $event)" (keydown)="onOtpKeydown(i, $event)" (paste)="onOtpPaste(i, $event)"
              [attr.aria-label]="'OTP digit ' + (i + 1)" />
          </div>
          <div class="resend-otp">
            Didn't receive OTP? <a href="#" (click)="$event.preventDefault(); sendOtp()">Resend</a>
          </div>
        </div>

        <button mat-raised-button class="btn-login" type="submit" [disabled]="submitting()" [attr.aria-busy]="submitting()">
          {{ submitting() ? 'Verifying…' : 'Verify & Sign In' }}
        </button>

        <div class="divider" role="separator" aria-label="Or continue with"><span>Or continue with</span></div>

        <div class="social" role="group" aria-label="Social sign in options">
          <button type="button" class="social-btn" (click)="socialAuth('google')" mat-button>
            <mat-icon svgIcon="auth-google" aria-hidden="true"></mat-icon>
            <span>Sign in with Google</span>
          </button>
          <button type="button" class="social-btn" (click)="socialAuth('microsoft')" mat-button>
            <mat-icon svgIcon="auth-microsoft" aria-hidden="true"></mat-icon>
            <span>Sign in with Microsoft</span>
          </button>
        </div>

        <p class="foot-link">
          Don't have an account?
          <a routerLink="/register" aria-label="Sign up">Sign up</a>
        </p>
      </form>
    </div>
  </section>
</div>
