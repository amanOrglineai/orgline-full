<div class="layout">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-top">
      <button class="avatar" aria-label="Profile">
        <span class="avatar-initial">üë§</span>
      </button>

      <nav class="nav">
        <a class="nav-item" routerLink="/dashboard" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
          <div class="nav-icon">üè†</div><span>Home</span>
        </a>
        <a class="nav-item" routerLink="/leaves" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
          <div class="nav-icon">üìÖ</div><span>Leaves</span>
        </a>
        <a class="nav-item" routerLink="/apply" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
          <div class="nav-icon">‚ûï</div><span>Apply</span>
        </a>
      </nav>
    </div>
  </aside>

  <!-- Main -->
  <main class="main">
    <!-- Top bar (user) -->
    <header class="topbar">
      <div class="spacer"></div>
      <div class="user-pill">
        <div class="user-avatar">JD</div>
        <span class="user-name">{{ userName }}</span>
        <mat-icon>keyboard_arrow_down</mat-icon>
      </div>
    </header>

    <!-- Page title -->
    <h1 class="page-title">
      <span class="title-icon">üß≥</span>
      My Leave and Attendance
    </h1>

    <!-- 3 cards row -->
    <section class="cards">
      <!-- Time Tracker -->
      <article class="card">
        <div class="card-title">
          <mat-icon class="muted">access_time</mat-icon>
          <span>Time Tracker</span>
        </div>

        <div class="time-rows">
          <div class="time-row">
            <div class="time-row-left">
              <span class="in-icon">‚Ü™</span>
              <span class="label">Punch In</span>
            </div>
            <div class="time-value">{{ inTime() }}</div>
          </div>

          <div class="time-row">
            <div class="time-row-left">
              <span class="out-icon">‚Ü©</span>
              <span class="label">Punch Out</span>
            </div>
            <div class="time-value">{{ outTime() }}</div>
          </div>
        </div>

        <div class="time-footer">
          <div class="hours">
            <div class="hours-label">Total Hours</div>
            <div class="hours-value">{{ totalHours() }}</div>
          </div>
          <button mat-flat-button color="primary" class="punch-btn" (click)="onPunchClick()">
            {{ punchButtonLabel() }}
          </button>
        </div>
      </article>

      <!-- My Leave Balance -->
      <article class="card">
        <div class="balance-head">
          <div class="balance-icon">‚è±Ô∏è</div>
          <div class="balance-title">My Leave Balance</div>
          <div class="balance-sub">
            Total: {{ totalLeaves() }}, Used: {{ usedLeaves() }}
          </div>
        </div>

        <div class="balance-available">
          Available: <span>{{ availableLeaves() }}</span>
        </div>

        <div class="balance-actions">
          <button mat-flat-button color="primary" routerLink="/apply">Apply Leave</button>
          <button mat-stroked-button routerLink="/leaves">My Leaves</button>
        </div>
      </article>

      <!-- Company Announcements -->
      <article class="card">
        <div class="ann-head">
          <div class="ann-icon">üì£</div>
          <div class="ann-title">Company Announcements</div>
        </div>

        <ng-container *ngIf="announcements().length; else noAnn">
          <p class="ann-text">
            {{ announcements()[0].body }}
          </p>
          <button mat-stroked-button class="linkish">
            {{ announcements()[0].ctaText }}
          </button>
        </ng-container>

        <ng-template #noAnn>
          <p class="ann-text">No announcements right now.</p>
        </ng-template>
      </article>
    </section>

    <section class="content-grid">
      <!-- Calendar -->
      <section class="calendar card">
        <header class="calendar-head">
          <button class="chev" (click)="prevMonth()">&lt;</button>
          <h2>{{ month }}</h2>
          <button class="chev" (click)="nextMonth()">&gt;</button>
        </header>

        <!-- Month stats (dynamic) -->
        <div class="month-stats">
          <span class="legend-chip"><i class="dot" data-type="P"></i> P: {{ monthStats().P }}</span>
          <span class="legend-chip"><i class="dot" data-type="HD"></i> HD: {{ monthStats().HD }}</span>
          <span class="legend-chip"><i class="dot" data-type="L"></i> L: {{ monthStats().L }}</span>
          <span class="legend-chip"><i class="dot" data-type="PH"></i> PH: {{ monthStats().PH }}</span>
          <span class="legend-chip"><i class="dot" data-type="WO"></i> WO: {{ monthStats().WO }}</span>
          <span class="legend-chip"><i class="dot" data-type="A"></i> A: {{ monthStats().A }}</span>
        </div>

        <div class="cal-grid">
          <div class="dow">Sun</div>
          <div class="dow">Mon</div>
          <div class="dow">Tue</div>
          <div class="dow">Wed</div>
          <div class="dow">Thu</div>
          <div class="dow">Fri</div>
          <div class="dow">Sat</div>

          <!-- dynamic calendar cells with marks -->
          <ng-container *ngFor="let c of cells()">
            <div class="cell"
                 [class.empty]="!c.inMonth"
                 [class.active]="isToday(c.date)"
                 (click)="selectDay(c)"
                 [attr.aria-label]="getTitle(c) || (c.date | date:'mediumDate')">
              {{ c.date.getDate() }}
              <span *ngIf="c.inMonth && c.mark"
                    class="dot"
                    [attr.data-type]="c.mark"
                    [title]="getTitle(c)"></span>
            </div>
          </ng-container>
        </div>

        <!-- Legend -->
        <div class="legend-row">
          <span class="legend-chip"><i class="dot" data-type="P"></i> P: Present</span>
          <span class="legend-chip"><i class="dot" data-type="HD"></i> HD: Half Day</span>
          <span class="legend-chip"><i class="dot" data-type="L"></i> L: Leave</span>
          <span class="legend-chip"><i class="dot" data-type="PH"></i> PH: Public Holiday</span>
          <span class="legend-chip"><i class="dot" data-type="WO"></i> WO: Week Off</span>
          <span class="legend-chip"><i class="dot" data-type="A"></i> A: Absent</span>
        </div>

        <!-- Day details -->
        <div class="day-details" *ngIf="selected() as s">
          <div class="dd-head">
            <div class="dd-date">{{ s.date | date:'fullDate' }}</div>
            <span class="legend-chip small"><i class="dot" [attr.data-type]="s.mark || 'A'"></i> {{ getTitle(s) || 'No mark' }}</span>
          </div>

          <div class="dd-grid">
            <div class="dd-card">
              <div class="dd-title">Attendance</div>
              <div *ngIf="dayPunches().length; else noPunch">
                <div class="punch-row" *ngFor="let p of dayPunches()">
                  <span class="mono">{{ (p.in | date:'shortTime') }}</span>
                  <span>‚Äì</span>
                  <span class="mono">{{ p.out ? (p.out | date:'shortTime') : '...' }}</span>
                </div>
              </div>
              <ng-template #noPunch><div class="muted">No punches.</div></ng-template>
            </div>

            <div class="dd-card">
              <div class="dd-title">Leaves</div>
              <div *ngIf="dayLeaves().length; else noLeaves">
                <div class="leave-row" *ngFor="let l of dayLeaves()">
                  <span class="badge">{{ (l.status || 'pending') | titlecase }}</span>
                  <span>{{ l.type || 'Leave' }}</span>
                  <span *ngIf="l.halfDay" class="muted">‚Ä¢ Half Day</span>
                </div>
              </div>
              <ng-template #noLeaves><div class="muted">No leave on this day.</div></ng-template>
            </div>
          </div>
        </div>
      </section>

      <!-- Right rail -->
      <aside class="right-rail">
        <section class="card notices">
          <h3 class="notices-title">HR Notices &amp; Updates</h3>

          <ng-container *ngIf="notices().length; else noNotices">
            <div class="notice" *ngFor="let n of notices()">
              <div class="n-icon">üìù</div>
              <div class="n-body">
                <div class="n-h">{{ n.title }}</div>
                <p>{{ n.body }}</p>
                <a class="n-link">{{ n.ctaText }}</a>
              </div>
            </div>
          </ng-container>

          <ng-template #noNotices>
            <p>No HR notices available.</p>
          </ng-template>
        </section>
      </aside>
    </section>
  </main>
</div>
